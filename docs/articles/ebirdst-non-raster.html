<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Non-raster Data: Using Predictor Importance, Partial Dependence, and Predictive Performance Metrics • ebirdst</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Non-raster Data: Using Predictor Importance, Partial Dependence, and Predictive Performance Metrics">
<meta property="og:description" content="ebirdst">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ebirdst</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/ebirdst.html">Get Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ebirdst-intro-mapping.html">Introduction to Mapping</a>
    </li>
    <li>
      <a href="../articles/ebirdst-advanced-mapping.html">Advanced Mapping</a>
    </li>
    <li>
      <a href="../articles/ebirdst-non-raster.html">Non-raster Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
<li>
  <a href="../articles/changelog.html">Changelog</a>
</li>
<li>
  <a href="../news/index.html">Version History</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CornellLabofOrnithology/ebirdst/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ebirdst-non-raster_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Non-raster Data: Using Predictor Importance, Partial Dependence, and Predictive Performance Metrics</h1>
                        <h4 class="author">Tom Auer, Daniel Fink</h4>
            
            <h4 class="date">2021-07-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/CornellLabofOrnithology/ebirdst/blob/master/vignettes/ebirdst-non-raster.Rmd"><code>vignettes/ebirdst-non-raster.Rmd</code></a></small>
      <div class="hidden name"><code>ebirdst-non-raster.Rmd</code></div>

    </div>

    
    
<div id="outline" class="section level1">
<h1 class="hasAnchor">
<a href="#outline" class="anchor"></a>Outline</h1>
<ol style="list-style-type: decimal">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#loading-centroids">Loading Centroids</a></li>
<li><a href="#selecting-region-and-season">Selecting Region and Season</a></li>
<li><a href="#plotting-centroids-and-extent-of-analysis">Plotting Centroids and Extent of Analysis</a></li>
<li><a href="#plot-predictor-importance">Plot Predictor Importance</a></li>
<li><a href="#plot-partial-dependencies">Plot Partial Dependencies</a></li>
<li><a href="#plot-partial-dependencies">Predictive Performance Metrics</a></li>
</ol>
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Beyond estimates of occurrence and relative abundance, the eBird Status and Trends products contain estimates of predictor importance (PI), partial dependence (PD), and predictive performance metrics (PPMs). The PPMs can be used to evaluate statistical performance of the models, either over the entire spatiotemporal extent of the model results, or for a specific region and season. Predictor importances (PIs) and partial dependences (PDs can be used to understand relationships between the occurrence or count response and predictors, most notably the land cover variables used in the model. The functions described in this section help load and analyse these data. More details about predictive performance metrics and how they were calculated and interpreted can be found in Fink et al. (2019).</p>
<div id="data-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#data-structure" class="anchor"></a>Data Structure</h2>
<p><strong>IMPORTANT. AFTER DOWNLOADING THE RESULTS, DO NOT CHANGE THE FILE STRUCTURE.</strong> All functionality in this package relies on the structure inherent in the delivered results. Changing the folder and file structure will cause errors with this package.</p>
<p>The non-raster data are stored in two SQLite databases:</p>
<ul>
<li>
<code>pi-pd.db</code>: predictor importance and partial dependence estimates for each stixel used to fit the model.</li>
<li>
<code>predictions.db</code>: predictions on a test dataset consisting of checklists not used in model fitting.</li>
</ul>
<p>The <code>ebirdst</code> package provides functions for accessing these, such that you should never have to handle them manually.</p>
</div>
</div>
<div id="pi-and-pd" class="section level1">
<h1 class="hasAnchor">
<a href="#pi-and-pd" class="anchor"></a>PI and PD</h1>
<p>We’ll start by loading the PI and PD data from the example data package for Yellow-bellied Sapsucker in Michigan.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CornellLabofOrnithology/ebirdst">ebirdst</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="co"># Because the non-raster data is large, there is a parameter on the</span>
<span class="co"># ebirdst_download function that defaults to downloading only the raster data.</span>
<span class="co"># To access the non-raster data, set tifs_only = FALSE.</span>
<span class="va">sp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ebirdst_download.html">ebirdst_download</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"example_data"</span>, tifs_only <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># predictor importance</span>
<span class="va">pis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_pis.html">load_pis</a></span><span class="op">(</span><span class="va">sp_path</span><span class="op">)</span>
<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">pis</span><span class="op">)</span>

<span class="co"># partial dependence</span>
<span class="va">pds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_pds.html">load_pds</a></span><span class="op">(</span><span class="va">sp_path</span><span class="op">)</span>
<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">pds</span><span class="op">)</span></code></pre></div>
<p>Notice that the data in both these data frames is provided for each stixel, identified by a <code>stixel_id</code>.</p>
<div id="selecting-region-and-season" class="section level2">
<h2 class="hasAnchor">
<a href="#selecting-region-and-season" class="anchor"></a>Selecting Region and Season</h2>
<p>When working with Predictive Performance Metrics (PPMs), PIs, or PDs, it is very common to select a subset of space and time for analysis. In <code>ebirdst</code> this is done by creating a spatiotemporal extent object with <code><a href="../reference/ebirdst_extent.html">ebirdst_extent()</a></code>. These objects define the region and season for analysis and are passed to many functions in <code>ebirdst</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define a spatiotemporal extent</span>
<span class="va">lp_extent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ebirdst_extent.html">ebirdst_extent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="fl">86</span>, xmax <span class="op">=</span> <span class="op">-</span><span class="fl">83</span>, ymin <span class="op">=</span> <span class="fl">42</span>, ymax <span class="op">=</span> <span class="fl">45</span><span class="op">)</span>,
                            t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.425</span>, <span class="fl">0.475</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://www.math.uzh.ch/pages/spam//reference/print.html">print</a></span><span class="op">(</span><span class="va">lp_extent</span><span class="op">)</span>

<span class="co"># subset to this extent</span>
<span class="va">pis_ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ebirdst_subset.html">ebirdst_subset</a></span><span class="op">(</span><span class="va">pis</span>, ext <span class="op">=</span> <span class="va">lp_extent</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">pis</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">pis_ss</span><span class="op">)</span></code></pre></div>
<p>To understand which stixels are contributing to estimates within a given spatiotemporal extent, <code><a href="../reference/stixel_footprint.html">stixel_footprint()</a></code> generate a <code>RasterLayer</code> depicting where a majority of the information is coming from within a given extent. The map ranges from 0 to 1, with pixels have a value of 1 meaning that 100% of the selected stixels are contributing information at that pixel. Calling <code><a href="https://rdrr.io/pkg/raster/man/plot.html">plot()</a></code> on the output of this function will map the stixel footprint as well as centroids of all the stixels.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>
<span class="va">footprint</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stixel_footprint.html">stixel_footprint</a></span><span class="op">(</span><span class="va">sp_path</span>, ext <span class="op">=</span> <span class="va">lp_extent</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">footprint</span><span class="op">)</span></code></pre></div>
</div>
<div id="plot-predictor-importance" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-predictor-importance" class="anchor"></a>Plot Predictor Importance</h2>
<p>The <code><a href="../reference/plot_pis.html">plot_pis()</a></code> function generates a bar plot showing a rank of the most important predictors within a spatiotemporal subset. There is an option to show all predictors or to aggregate FRAGSTATS by the land cover types.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># with all classes</span>
<span class="fu"><a href="../reference/plot_pis.html">plot_pis</a></span><span class="op">(</span><span class="va">pis</span>, ext <span class="op">=</span> <span class="va">lp_extent</span>, by_cover_class <span class="op">=</span> <span class="cn">FALSE</span>, n_top_pred <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>

<span class="co"># aggregating fragstats for cover classes</span>
<span class="fu"><a href="../reference/plot_pis.html">plot_pis</a></span><span class="op">(</span><span class="va">pis</span>, ext <span class="op">=</span> <span class="va">lp_extent</span>, by_cover_class <span class="op">=</span> <span class="cn">TRUE</span>, n_top_pred <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></code></pre></div>
</div>
<div id="plotting-partial-dependence" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-partial-dependence" class="anchor"></a>Plotting Partial Dependence</h2>
<p>Smoothed partial dependence curves for a given predictor can be plotted using <code><a href="../reference/plot_pds.html">plot_pds()</a></code>. Confidence intervals are estimated through a processing of subsampling and bootstrapping. This function returns the smoothed data and CIs and plots these data. For example, let’s look at PD curves for checklist start time, expressed as the difference from solar noon, and the percentage of broadleaf forest cover. The full list of predictors see the data frame <code>ebirdst_predictors</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># in the interest of speed, run with 5 bootstrap iterations</span>
<span class="co"># in practice, best to run with the default number of iterations (100)</span>
<span class="va">pd_smooth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_pds.html">plot_pds</a></span><span class="op">(</span><span class="va">pds</span>, <span class="st">"solar_noon_diff"</span>, ext <span class="op">=</span> <span class="va">lp_extent</span>, n_bs <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">pd_smooth</span><span class="op">)</span>

<span class="co"># deciduous broadleaf forest</span>
<span class="fu"><a href="../reference/plot_pds.html">plot_pds</a></span><span class="op">(</span><span class="va">pds</span>, <span class="st">"mcd12q1_lccs1_fs_c14_1500_pland"</span>, ext <span class="op">=</span> <span class="va">lp_extent</span>, n_bs <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="predictive-performance-metrics" class="section level1">
<h1 class="hasAnchor">
<a href="#predictive-performance-metrics" class="anchor"></a>Predictive Performance Metrics</h1>
<p>Beyond confidence intervals provided for the abundance estimates, the centroid data can also be used to calculate predictive performance metrics, to get an idea as to whether there is substantial statistical performance to evaluate information provided by PIs and PDs (as well as abundance and occurrence information). Three types of PPMs are calculated:</p>
<ul>
<li>
<strong>Binary or range-based PPMs</strong> assess the ability of model to predict range boundaries</li>
<li>
<strong>Occurrence PPMs</strong> assess the occurrence probability predictions</li>
<li>
<strong>Abundance PPMs</strong> assess the predicted abundance</li>
</ul>
<p>Both the occurrence and count PPMs are within-range metrics, meaning the comparison between observations and predictions is only made within the range where the species occurs.</p>
<p>The function <code><a href="../reference/ebirdst_ppms.html">ebirdst_ppms()</a></code> calculates a suite of PPMs for a given spatiotemporal extent. The results can then be plotted with <code><a href="https://rdrr.io/pkg/raster/man/plot.html">plot()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ppms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ebirdst_ppms.html">ebirdst_ppms</a></span><span class="op">(</span><span class="va">sp_path</span>, ext <span class="op">=</span> <span class="va">lp_extent</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ppms</span><span class="op">)</span></code></pre></div>
<p><code><a href="../reference/ebirdst_ppms_ts.html">ebirdst_ppms_ts()</a></code> can be used to get a time series of PPMs, calculating the full suite either at a weekly or monthly resolution. <code><a href="https://rdrr.io/pkg/raster/man/plot.html">plot()</a></code> can be used to visualise these PPM time series for a given PPM.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ppms_monthly</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ebirdst_ppms_ts.html">ebirdst_ppms_ts</a></span><span class="op">(</span><span class="va">sp_path</span>, ext <span class="op">=</span> <span class="va">lp_extent</span>, summarize_by <span class="op">=</span> <span class="st">"months"</span><span class="op">)</span>
<span class="co"># plot binary kappa</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ppms_monthly</span>, type <span class="op">=</span> <span class="st">"binary"</span>, metric <span class="op">=</span> <span class="st">"kappa"</span><span class="op">)</span>
<span class="co"># plot occurrence probability auc</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ppms_monthly</span>, type <span class="op">=</span> <span class="st">"occurrence"</span>, metric <span class="op">=</span> <span class="st">"auc"</span><span class="op">)</span></code></pre></div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>Fink, D., T. Damoulas, &amp; J. Dave, J. 2013. Adaptive Spatio-Temporal Exploratory Models: Hemisphere-wide species distributions from massively crowdsourced eBird data. In Twenty-Seventh AAAI Conference on Artificial Intelligence.</p>
<p>Fink, D., W.M. Hochachka, B. Zuckerberg, D.W. Winkler, B. Shaby, M.A. Munson, G. Hooker, M. Riedewald, D. Sheldon, &amp; S. Kelling. 2010. Spatiotemporal exploratory models for broad‐scale survey data. Ecological Applications, 20(8), 2131-2147.</p>
<p>Fink, D., T. Auer, A. Johnston, V. Ruiz‐Gutierrez, W.M. Hochachka, &amp; S. Kelling. 2019. Modeling avian full annual cycle distribution and population trends with citizen science data. Ecological Applications, 00(00):e02056. <a href="https://doi.org/10.1002/eap.2056" class="uri">https://doi.org/10.1002/eap.2056</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://strimas.com">Matthew Strimas-Mackey</a>, Shawn Ligocki, <a href="http://twitter.com/tom_auer">Tom Auer</a>, Daniel Fink.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
